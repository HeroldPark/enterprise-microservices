server:
  port: 8080

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      
      # â­ CORS ì „ì—­ ì„¤ì •
      globalcors:
        add-to-simple-url-handler-mapping: true
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"     # React
              - "http://localhost:5173"     # Vite
              - "http://localhost:8080"     # Gateway
              - "https://myapp.com"         # ì¶”ê°€
              - "https://admin.myapp.com"   # ì¶”ê°€
            allowedMethods:
              - "*"
            allowedHeaders:
              - "*"
            allowCredentials: true
            maxAge: 3600

# ============================================================
# ğŸ”§ Gateway ë¼ìš°íŒ… ì„¤ì • (ìŠ¤ì¼€ì¼ ì•„ì›ƒìš©)
# ============================================================
gateway:
  routes:
    strip-prefix: 1
    
    # User Service ì„¤ì •
    user:
      service-uri: lb://user-service
      auth-path: /api/auth/**
      api-path: /api/users/**
      api-admin-path: /api/admin/users/**
      api-system-path: /api/admin/settings/**
      api-model-path: /api/admin/model-configs/**

    # Product Service ì„¤ì •
    product:
      service-uri: lb://product-service
      api-path: /api/products/**
      require-auth: false
    
    # Order Service ì„¤ì •
    order:
      service-uri: lb://order-service
      api-path: /api/orders/**
      require-auth: true
    
    # Board Service ì„¤ì •
    board:
      service-uri: lb://board-service
      api-path: /api/boards/**
      search-path: /api/boards/search/**
      public-methods:
        - GET
      auth-methods:
        - POST
        - PUT
        - DELETE

    # â­ Admin Service ì„¤ì • (ìƒˆë¡œ ì¶”ê°€)
    admin:
      service-uri: lb://admin-service
      api-path: /api/admin/menus/**
      require-auth: true
      admin-only: true

    # Payment Service ì¶”ê°€
    payment:
      service-uri: lb://payment-service
      api-path: /api/payments/**
      require-auth: true

  # ============================================================
  # ğŸ” Security ê²½ë¡œ ì„¤ì • (ìŠ¤ì¼€ì¼ ì•„ì›ƒìš©)
  # ============================================================
  security:
    authenticate-all: false
    
    # Public Paths (ì¸ì¦ ë¶ˆí•„ìš”)
    public-paths:
      auth:
        - /api/auth/**  # ë¡œê·¸ì¸, íšŒì›ê°€ì…
        - /auth/**
      
      products-get:
        - /api/products/**  # ìƒí’ˆ ì¡°íšŒ
      
      orders:
        - /api/orders/**    # ìƒí’ˆ ì£¼ë¬¸

      boards-get:
        - /api/boards/**  # ê²Œì‹œê¸€ ì¡°íšŒ
        - /boards/**
      
      actuator:
        - /actuator/**

      payment-check:
        - /api/payments/status/**  # ê²°ì œ ìƒíƒœ ì¡°íšŒëŠ” public
    
    # Authenticated Paths (ì¸ì¦ í•„ìš”)
    authenticated-paths:
      boards-write:
        - /api/boards/**  # POST, PUT, DELETE ì‹œ ì¸ì¦ í•„ìš”
      
      # â­ Admin ê²½ë¡œ (ADMIN ê¶Œí•œ í•„ìš”)
      admin-menus:
        - /api/admin/menus/**  # ë©”ë‰´ ê´€ë¦¬ëŠ” ADMINë§Œ ê°€ëŠ¥

# Eureka ì„¤ì •
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
    register-with-eureka: true
    fetch-registry: true
  instance:
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 10

# JWT ì„¤ì •
jwt:
  secret: your-secret-key-must-be-at-least-256-bits-long-for-HS256-algorithm
  expiration: 86400000  # 24ì‹œê°„ (ë°€ë¦¬ì´ˆ)

# Actuator ì„¤ì • - ëª¨ë‹ˆí„°ë§
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway,refresh
  endpoint:
    health:
      show-details: always
    refresh:
      enabled: true

# ë¡œê¹… ì„¤ì •
logging:
  level:
    root: INFO
    com.enterprise.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.web.cors: DEBUG
    org.springframework.security: DEBUG

---
# ============================================================
# ğŸ› ï¸ ê°œë°œ í™˜ê²½ í”„ë¡œíŒŒì¼
# ì‹¤í–‰ ë°©ë²•
# java -jar gateway.jar --spring.profiles.active=dev
# ============================================================
spring:
  config:
    activate:
      on-profile: dev

gateway:
  security:
    authenticate-all: false
    public-paths:
      orders:
        - /api/orders/**

logging:
  level:
    com.enterprise.gateway: TRACE

---
# ============================================================
# ğŸš€ í”„ë¡œë•ì…˜ í™˜ê²½ í”„ë¡œíŒŒì¼
# java -jar gateway.jar --spring.profiles.active=prod
# ============================================================
spring:
  config:
    activate:
      on-profile: prod
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "https://yourdomain.com"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
            allowedHeaders:
              - "*"
            allowCredentials: true
            maxAge: 3600

gateway:
  security:
    authenticate-all: true
    public-paths:
      orders: []
    authenticated-paths:
      orders:
        - /api/orders/**
      admin-menus:
        - /api/admin/menus/**

logging:
  level:
    root: WARN
    com.enterprise.gateway: INFO

---
# ============================================================
# ğŸ§ª ìŠ¤í…Œì´ì§• í™˜ê²½ í”„ë¡œíŒŒì¼
# java -jar gateway.jar --spring.profiles.active=staging
# ============================================================
spring:
  config:
    activate:
      on-profile: staging

gateway:
  security:
    authenticate-all: true
    public-paths:
      orders: []
    authenticated-paths:
      admin-menus:
        - /api/admin/menus/**

logging:
  level:
    com.enterprise.gateway: DEBUG