# Eureka ì™„ë²½ ê°€ì´ë“œ

## ğŸ“š ëª©ì°¨

1. [Eurekaë€ ë¬´ì—‡ì¸ê°€?](#eurekaë€-ë¬´ì—‡ì¸ê°€)
2. [ì™œ í•„ìš”í•œê°€?](#ì™œ-í•„ìš”í•œê°€)
3. [Eureka ì•„í‚¤í…ì²˜](#eureka-ì•„í‚¤í…ì²˜)
4. [í•µì‹¬ ê°œë…](#í•µì‹¬-ê°œë…)
5. [ì„¤ì • ë°©ë²•](#ì„¤ì •-ë°©ë²•)
6. [ë™ì‘ ì›ë¦¬](#ë™ì‘-ì›ë¦¬)
7. [ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ](#ì‹¤ì œ-ì‚¬ìš©-ì˜ˆì‹œ)
8. [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
9. [Eureka Dashboard](#eureka-dashboard)
10. [ë‹¤ë¥¸ Service Discoveryì™€ ë¹„êµ](#ë‹¤ë¥¸-service-discoveryì™€-ë¹„êµ)
11. [Docker í™˜ê²½ ì„¤ì •](#docker-í™˜ê²½-ì„¤ì •)
12. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
13. [Best Practices](#best-practices)

---

## Eurekaë€ ë¬´ì—‡ì¸ê°€?

Netflixì—ì„œ ê°œë°œí•œ **ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬(Service Discovery)** ë„êµ¬ì…ë‹ˆë‹¤. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ì„œë¹„ìŠ¤ë“¤ì´ ì„œë¡œë¥¼ ì°¾ê³  í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

- **ë™ì  ì„œë¹„ìŠ¤ ë“±ë¡**: ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ë©´ ìë™ìœ¼ë¡œ Eurekaì— ë“±ë¡
- **ìë™ Health Check**: ì£¼ê¸°ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
- **ë¡œë“œ ë°¸ëŸ°ì‹±**: ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ë¥¼ ìë™ ì„ íƒ
- **ì¥ì•  ì¡°ì¹˜(Failover)**: ì£½ì€ ì„œë¹„ìŠ¤ëŠ” ìë™ìœ¼ë¡œ ì œì™¸

---

## ì™œ í•„ìš”í•œê°€?

### ì „í†µì ì¸ ë°©ì‹ì˜ ë¬¸ì œì 

```java
// âŒ í•˜ë“œì½”ë”©ëœ URL
String userServiceUrl = "http://192.168.1.10:8081";
String productServiceUrl = "http://192.168.1.20:8082";
```

**ë¬¸ì œì :**
- ì„œë²„ IPê°€ ë°”ë€Œë©´? â†’ ì½”ë“œ ìˆ˜ì • í•„ìš”
- ì„œë²„ê°€ ì—¬ëŸ¬ ëŒ€ë©´? â†’ ì–´ëŠ ì„œë²„ë¡œ ìš”ì²­?
- ì„œë²„ê°€ ì£½ìœ¼ë©´? â†’ ê³„ì† ì‹¤íŒ¨
- í™•ì¥/ì¶•ì†Œê°€ ì–´ë ¤ì›€

### Eurekaë¥¼ ì‚¬ìš©í•œ ë°©ì‹

```java
// âœ… ì„œë¹„ìŠ¤ ì´ë¦„ë§Œ ì‚¬ìš©
String userServiceUrl = "lb://user-service";  // Load Balanced
```

**ì¥ì :**
- IP ëª°ë¼ë„ ë¨
- ìë™ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë²„ ì°¾ìŒ
- ì£½ì€ ì„œë²„ëŠ” ìë™ ì œì™¸
- ì„œë²„ ì¶”ê°€/ì œê±° ììœ ë¡œì›€

---

## Eureka ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Eureka Server (8761)                  â”‚
â”‚                                                 â”‚
â”‚  Service Registry (ë“±ë¡ë¶€)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ USER-SERVICE    â†’ 192.168.1.10:8081     â”‚  â”‚
â”‚  â”‚ USER-SERVICE    â†’ 192.168.1.11:8081     â”‚  â”‚
â”‚  â”‚ PRODUCT-SERVICE â†’ 192.168.1.20:8082     â”‚  â”‚
â”‚  â”‚ ORDER-SERVICE   â†’ 192.168.1.30:8083     â”‚  â”‚
â”‚  â”‚ API-GATEWAY     â†’ 192.168.1.40:8080     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ ë“±ë¡                â†‘ ì¡°íšŒ
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Service â”‚          â”‚ Client  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬ì„± ìš”ì†Œ

1. **Eureka Server**: ëª¨ë“  ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘ì•™ ë ˆì§€ìŠ¤íŠ¸ë¦¬
2. **Eureka Client (ì„œë¹„ìŠ¤)**: Eurekaì— ìì‹ ì„ ë“±ë¡í•˜ê³  ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì •ë³´ ì¡°íšŒ
3. **Service Consumer**: Eurekaë¥¼ í†µí•´ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì•„ì„œ í˜¸ì¶œ

---

## í•µì‹¬ ê°œë…

### 1. Eureka Server (ë“±ë¡ ì„œë²„)

ëª¨ë“  ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” **ì „í™”ë²ˆí˜¸ë¶€** ì—­í• 

- ê¸°ë³¸ í¬íŠ¸: **8761**
- ì„œë¹„ìŠ¤ ë“±ë¡ ì •ë³´ ê´€ë¦¬
- Health Check ìˆ˜í–‰
- Dashboard ì œê³µ

### 2. Eureka Client (ì„œë¹„ìŠ¤)

Eureka Serverì— **ìì‹ ì„ ë“±ë¡**í•˜ëŠ” ì„œë¹„ìŠ¤

- ì‹œì‘ ì‹œ Eurekaì— ë“±ë¡
- ì£¼ê¸°ì ìœ¼ë¡œ Heartbeat ì „ì†¡ (ê¸°ë³¸ 30ì´ˆ)
- ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì •ë³´ ì¡°íšŒ

### 3. Service Registry

ë“±ë¡ëœ ëª¨ë“  ì„œë¹„ìŠ¤ì˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” **ì €ì¥ì†Œ**

```
ì„œë¹„ìŠ¤ëª…: USER-SERVICE
ì¸ìŠ¤í„´ìŠ¤:
  - IP: 192.168.1.10, Port: 8081, Status: UP
  - IP: 192.168.1.11, Port: 8081, Status: UP
```

### 4. Heartbeat

ì„œë¹„ìŠ¤ê°€ ì‚´ì•„ìˆìŒì„ ì•Œë¦¬ëŠ” **ìƒì¡´ ì‹ í˜¸**

- ê¸°ë³¸ ê°„ê²©: 30ì´ˆ
- 90ì´ˆ ë™ì•ˆ ì‘ë‹µ ì—†ìœ¼ë©´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì œê±°

---

## ì„¤ì • ë°©ë²•

### Eureka Server ì„¤ì •

#### 1. ì˜ì¡´ì„± ì¶”ê°€

**pom.xml (Maven)**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
</dependency>
```

**build.gradle (Gradle)**
```gradle
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-server'
```

#### 2. Application í´ë˜ìŠ¤

```java
package com.enterprise.eureka;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@SpringBootApplication
@EnableEurekaServer  // â­ Eureka ì„œë²„ í™œì„±í™”
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

#### 3. application.yml

```yaml
server:
  port: 8761

spring:
  application:
    name: eureka-server

eureka:
  client:
    register-with-eureka: false  # ìê¸° ìì‹ ì€ ë“±ë¡ ì•ˆ í•¨
    fetch-registry: false        # ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì•ˆ ê°€ì ¸ì˜´
  server:
    enable-self-preservation: true  # ë„¤íŠ¸ì›Œí¬ ì¥ì•  ë³´í˜¸ ëª¨ë“œ
    eviction-interval-timer-in-ms: 60000  # ì œê±° ì²´í¬ ì£¼ê¸° (1ë¶„)
```

---

### Eureka Client ì„¤ì • (ì„œë¹„ìŠ¤)

#### 1. ì˜ì¡´ì„± ì¶”ê°€

**pom.xml**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

**build.gradle**
```gradle
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'
```

#### 2. Application í´ë˜ìŠ¤

```java
package com.enterprise.user;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient  // â­ Eureka í´ë¼ì´ì–¸íŠ¸ í™œì„±í™”
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

#### 3. application.yml

```yaml
server:
  port: 8081

spring:
  application:
    name: user-service  # â­ ê°€ì¥ ì¤‘ìš”! ì„œë¹„ìŠ¤ ì‹ë³„ì

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # Eureka ì„œë²„ ì£¼ì†Œ
    register-with-eureka: true   # ìì‹ ì„ ë“±ë¡
    fetch-registry: true          # ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì •ë³´ ê°€ì ¸ì˜´
  instance:
    prefer-ip-address: true       # IP ì£¼ì†Œ ì‚¬ìš©
    instance-id: ${spring.application.name}:${random.value}
    lease-renewal-interval-in-seconds: 10    # Heartbeat ê°„ê²© (10ì´ˆ)
    lease-expiration-duration-in-seconds: 30 # 30ì´ˆ ì‘ë‹µ ì—†ìœ¼ë©´ ì œì™¸
```

---

## ë™ì‘ ì›ë¦¬

### 1. ì„œë¹„ìŠ¤ ë“±ë¡ (Registration)

```
User Service ì‹œì‘
    â†“
Eureka Serverì— ë“±ë¡ ìš”ì²­
    â†“
"ì €ëŠ” USER-SERVICEì´ê³  192.168.1.10:8081ì— ìˆì–´ìš”!"
    â†“
Eureka Server: "ë“±ë¡ ì™„ë£Œ!"
```

**ë¡œê·¸ ì˜ˆì‹œ:**
```
DiscoveryClient_USER-SERVICE - registration status: 204
```

### 2. Heartbeat (ìƒì¡´ ì‹ í˜¸)

```
10ì´ˆë§ˆë‹¤
    â†“
User Service â†’ Eureka Server: "ì‚´ì•„ìˆì–´ìš”!"
    â†“
Eureka Server: "í™•ì¸!"
```

**30ì´ˆ ë™ì•ˆ ì‘ë‹µ ì—†ìœ¼ë©´ â†’ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì œê±°**

### 3. ì„œë¹„ìŠ¤ ë°œê²¬ (Discovery)

```
API Gatewayê°€ User Service í˜¸ì¶œ í•„ìš”
    â†“
Eureka Serverì— ì¡°íšŒ: "USER-SERVICE ì–´ë”” ìˆì–´?"
    â†“
Eureka Server: "192.168.1.10:8081, 192.168.1.11:8081ì— ìˆì–´ìš”!"
    â†“
API Gateway: ë‘˜ ì¤‘ í•˜ë‚˜ ì„ íƒí•´ì„œ í˜¸ì¶œ (Load Balancing)
```

### 4. Health Check

```
ì£¼ê¸°ì ìœ¼ë¡œ (ê¸°ë³¸ 30ì´ˆ)
    â†“
ê° ì„œë¹„ìŠ¤ì—ì„œ Heartbeat ì „ì†¡
    â†“
ì‘ë‹µ ì—†ëŠ” ì„œë¹„ìŠ¤ëŠ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì œê±°
    â†“
ì´í›„ ìš”ì²­ì€ ì •ìƒ ì„œë¹„ìŠ¤ë¡œë§Œ ì „ë‹¬
```

---

## ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### Spring Cloud Gatewayì—ì„œ ì‚¬ìš©

```java
package com.enterprise.gateway.config;

import org.springframework.cloud.gateway.route.RouteLocator;
import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class GatewayConfig {
    
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
        return builder.routes()
            // Eurekaë¥¼ í†µí•œ ë¼ìš°íŒ…
            .route("user-service", r -> r
                .path("/api/users/**")
                .uri("lb://user-service"))  // â­ lb://ì„œë¹„ìŠ¤ëª…
            
            .route("product-service", r -> r
                .path("/api/products/**")
                .uri("lb://product-service"))
            
            .route("order-service", r -> r
                .path("/api/orders/**")
                .uri("lb://order-service"))
            
            .build();
    }
}
```

**`lb://user-service` ì˜ë¯¸:**
- `lb` = Load Balancer
- Eurekaì—ì„œ `user-service` ì¡°íšŒ
- ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ìŠ¤í„´ìŠ¤ ì¤‘ í•˜ë‚˜ ì„ íƒ
- ìë™ ë¡œë“œ ë°¸ëŸ°ì‹±

### RestTemplateì—ì„œ ì‚¬ìš©

```java
package com.enterprise.order.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class RestTemplateConfig {
    
    @Bean
    @LoadBalanced  // â­ ë¡œë“œ ë°¸ëŸ°ì‹± í™œì„±í™”
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

```java
package com.enterprise.order.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

@Service
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public User getUser(Long userId) {
        // Eurekaê°€ ìë™ìœ¼ë¡œ user-service IP ì°¾ì•„ì¤Œ
        return restTemplate.getForObject(
            "http://user-service/users/" + userId,  // â­ ì„œë¹„ìŠ¤ëª… ì‚¬ìš©
            User.class
        );
    }
    
    public Product getProduct(Long productId) {
        return restTemplate.getForObject(
            "http://product-service/products/" + productId,
            Product.class
        );
    }
}
```

### WebClientì—ì„œ ì‚¬ìš© (Reactive)

```java
package com.enterprise.order.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.reactive.function.client.WebClient;

@Configuration
public class WebClientConfig {
    
    @Bean
    @LoadBalanced
    public WebClient.Builder webClientBuilder() {
        return WebClient.builder();
    }
}
```

```java
package com.enterprise.order.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.core.publisher.Mono;

@Service
public class OrderServiceReactive {
    
    @Autowired
    private WebClient.Builder webClientBuilder;
    
    public Mono<User> getUser(Long userId) {
        return webClientBuilder.build()
            .get()
            .uri("http://user-service/users/{id}", userId)
            .retrieve()
            .bodyToMono(User.class);
    }
}
```

---

## ì£¼ìš” ê¸°ëŠ¥

### 1. Load Balancing (ë¶€í•˜ ë¶„ì‚°)

```
USER-SERVICE ì¸ìŠ¤í„´ìŠ¤ 3ê°œ ë“±ë¡:
- 192.168.1.10:8081
- 192.168.1.11:8081
- 192.168.1.12:8081

ìš”ì²­ â†’ ìë™ìœ¼ë¡œ 3ê°œ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ì‚°
```

**ë¼ìš´ë“œ ë¡œë¹ˆ ë°©ì‹:**
```
Request 1 â†’ 192.168.1.10:8081
Request 2 â†’ 192.168.1.11:8081
Request 3 â†’ 192.168.1.12:8081
Request 4 â†’ 192.168.1.10:8081
...
```

### 2. Failover (ì¥ì•  ì¡°ì¹˜)

```
ì¸ìŠ¤í„´ìŠ¤ 1: âŒ ì£½ìŒ (30ì´ˆ ì‘ë‹µ ì—†ìŒ)
    â†“
Eureka: ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì œê±°
    â†“
ì´í›„ ìš”ì²­ì€ ì¸ìŠ¤í„´ìŠ¤ 2, 3ë§Œ ì‚¬ìš©
```

### 3. Self-Preservation Mode (ìê¸° ë³´ì¡´ ëª¨ë“œ)

```
ë„¤íŠ¸ì›Œí¬ ì¥ì• ë¡œ ë§ì€ ì„œë¹„ìŠ¤ê°€ Heartbeat ëª» ë³´ëƒ„
    â†“
Eureka: "ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì¸ ê²ƒ ê°™ìœ¼ë‹ˆ ì„œë¹„ìŠ¤ ì œê±° ì•ˆ í•¨"
    â†“
ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ë˜ë©´ ì •ìƒí™”
```

**ê²½ê³  ë©”ì‹œì§€:**
```
EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP 
WHEN THEY'RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE 
THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE.
```

**ì„¤ì •:**
```yaml
eureka:
  server:
    enable-self-preservation: true  # ê¸°ë³¸ê°’
```

### 4. Service Status ê´€ë¦¬

```
Status ì¢…ë¥˜:
- UP: ì •ìƒ ì‘ë™
- DOWN: ì„œë¹„ìŠ¤ ë‹¤ìš´
- STARTING: ì‹œì‘ ì¤‘
- OUT_OF_SERVICE: ì„œë¹„ìŠ¤ ì¤‘ë‹¨ (ìˆ˜ë™)
- UNKNOWN: ì•Œ ìˆ˜ ì—†ìŒ
```

---

## Eureka Dashboard

### ì ‘ì†

```
http://localhost:8761
```

### Dashboard í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System Status                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Environment  â”‚ test                      â”‚
â”‚ Data center  â”‚ default                   â”‚
â”‚ Current time â”‚ 2025-12-27 17:30:00      â”‚
â”‚ Uptime       â”‚ 01:23                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Instances currently registered           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application  â”‚ AMIs   â”‚ Status          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ USER-SERVICE â”‚ n/a(2) â”‚ UP (2)          â”‚
â”‚ API-GATEWAY  â”‚ n/a(1) â”‚ UP (1)          â”‚
â”‚ PRODUCT-SVC  â”‚ n/a(3) â”‚ UP (3)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìƒì„¸ ì •ë³´ í™•ì¸

Application ì´ë¦„ í´ë¦­ ì‹œ:

```
Instance Info
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ipAddr: 192.168.1.10
status: UP
port: 8081
healthCheckUrl: http://192.168.1.10:8081/actuator/health
statusPageUrl: http://192.168.1.10:8081/actuator/info
homePageUrl: http://192.168.1.10:8081/
lastRenewalTimestamp: 1703683800
```

---

## ë‹¤ë¥¸ Service Discoveryì™€ ë¹„êµ

| íŠ¹ì§• | Eureka | Consul | Zookeeper | etcd |
|------|--------|--------|-----------|------|
| **ê°œë°œì‚¬** | Netflix | HashiCorp | Apache | CoreOS |
| **ì–¸ì–´** | Java | Go | Java | Go |
| **CAP ì´ë¡ ** | AP | CP | CP | CP |
| **Health Check** | Heartbeat | ë‹¤ì–‘ (HTTP, TCP, Script) | Heartbeat | TTL |
| **UI Dashboard** | âœ… | âœ… | âŒ | âŒ |
| **Key-Value Store** | âŒ | âœ… | âœ… | âœ… |
| **ë‹¤ì¤‘ ë°ì´í„°ì„¼í„°** | âŒ | âœ… | âŒ | âœ… |
| **í•™ìŠµ ë‚œì´ë„** | ì‰¬ì›€ | ë³´í†µ | ì–´ë ¤ì›€ | ë³´í†µ |
| **Spring Cloud í†µí•©** | âœ… ì™„ë²½ | âœ… ì¢‹ìŒ | âš ï¸ ë³´í†µ | âš ï¸ ë³´í†µ |

### CAP ì´ë¡ 

**AP (Eureka): Availability + Partition Tolerance**
- ê°€ìš©ì„± ìš°ì„ 
- ì¼ì‹œì  ë¶ˆì¼ì¹˜ í—ˆìš©
- ë„¤íŠ¸ì›Œí¬ ë¶„í•  ì‹œì—ë„ ì‘ë™

**CP (Consul, Zookeeper): Consistency + Partition Tolerance**
- ì¼ê´€ì„± ìš°ì„ 
- ë°ì´í„° ì¼ì¹˜ ë³´ì¥
- ë„¤íŠ¸ì›Œí¬ ë¶„í•  ì‹œ ì¼ë¶€ ë…¸ë“œ ì‚¬ìš© ë¶ˆê°€

### ì–¸ì œ Eurekaë¥¼ ì‚¬ìš©í• ê¹Œ?

âœ… **Eureka ì¶”ì²œ:**
- Spring Boot / Spring Cloud ì‚¬ìš©
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- ë¹ ë¥¸ êµ¬ì¶• í•„ìš”
- ê°€ìš©ì„±ì´ ì¼ê´€ì„±ë³´ë‹¤ ì¤‘ìš”

âš ï¸ **ë‹¤ë¥¸ ë„êµ¬ ê³ ë ¤:**
- Kubernetes í™˜ê²½ â†’ **Kubernetes Service Discovery**
- ì„¤ì • ê´€ë¦¬ í•„ìš” â†’ **Consul**
- ê°•í•œ ì¼ê´€ì„± í•„ìš” â†’ **Consul, Zookeeper**
- ë‹¤ì¤‘ ë°ì´í„°ì„¼í„° â†’ **Consul**

---

## Docker í™˜ê²½ ì„¤ì •

### Docker Compose ì˜ˆì‹œ

```yaml
version: '3.8'

services:
  # Eureka Server
  eureka-server:
    image: eureka-server:latest
    container_name: eureka-server
    ports:
      - "8761:8761"
    networks:
      - microservices-network
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8761/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 5

  # User Service
  user-service:
    image: user-service:latest
    container_name: user-service
    ports:
      - "8081:8081"
    networks:
      - microservices-network
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mariadb://mariadb:3306/user-db
    depends_on:
      eureka-server:
        condition: service_healthy

  # Product Service
  product-service:
    image: product-service:latest
    container_name: product-service
    ports:
      - "8082:8082"
    networks:
      - microservices-network
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mariadb://mariadb:3306/product-db
    depends_on:
      eureka-server:
        condition: service_healthy

networks:
  microservices-network:
    driver: bridge
```

### ì£¼ì˜ì‚¬í•­

**âŒ ì˜ëª»ëœ ì„¤ì • (localhost):**
```yaml
environment:
  - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://localhost:8761/eureka/
```

**âœ… ì˜¬ë°”ë¥¸ ì„¤ì • (ì»¨í…Œì´ë„ˆëª…):**
```yaml
environment:
  - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
```

Docker ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” `localhost`ê°€ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚¤ë¯€ë¡œ, **ì»¨í…Œì´ë„ˆ ì´ë¦„**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤!

---

## ë¬¸ì œ í•´ê²°

### ì„œë¹„ìŠ¤ê°€ ë“±ë¡ ì•ˆ ë  ë•Œ

#### 1. Eureka Server ì‹¤í–‰ í™•ì¸

```bash
curl http://localhost:8761
```

ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì† í™•ì¸

#### 2. application.yml í™•ì¸

```yaml
spring:
  application:
    name: user-service  # â­ ìˆë‚˜ìš”?

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # â­ ì˜¬ë°”ë¥¸ê°€ìš”?
    register-with-eureka: true  # â­ trueì¸ê°€ìš”?
```

#### 3. @EnableDiscoveryClient í™•ì¸

```java
@SpringBootApplication
@EnableDiscoveryClient  // â­ ìˆë‚˜ìš”?
public class UserServiceApplication {
    // ...
}
```

#### 4. ì˜ì¡´ì„± í™•ì¸

**pom.xml:**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

**build.gradle:**
```gradle
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'
```

#### 5. ë„¤íŠ¸ì›Œí¬ í™•ì¸

```bash
# Eureka ì„œë²„ì— ì ‘ì† ê°€ëŠ¥í•œê°€?
curl http://localhost:8761/eureka/apps

# ë°©í™”ë²½ í™•ì¸
telnet localhost 8761
```

#### 6. ë¡œê·¸ í™•ì¸

```
Started UserServiceApplication in 5.2 seconds
DiscoveryClient_USER-SERVICE - registration status: 204  â† ì´ê²Œ ë‚˜ì™€ì•¼ í•¨
```

### ì„œë¹„ìŠ¤ê°€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œ

#### ì›ì¸ 1: Heartbeat ì‹¤íŒ¨

```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 10  # ë„ˆë¬´ ì§§ìœ¼ë©´ ì¦ê°€
    lease-expiration-duration-in-seconds: 30  # ë„ˆë¬´ ì§§ìœ¼ë©´ ì¦ê°€
```

#### ì›ì¸ 2: ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •

```yaml
eureka:
  server:
    enable-self-preservation: true  # Self-Preservation ëª¨ë“œ í™œì„±í™”
```

#### ì›ì¸ 3: ì„œë¹„ìŠ¤ í¬ë˜ì‹œ

ë¡œê·¸ í™•ì¸:
```bash
# Docker
docker logs user-service

# ì¼ë°˜
tail -f logs/application.log
```

### Self-Preservation ê²½ê³ 

```
EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP...
```

**ì˜ë¯¸:**
- ë§ì€ ì„œë¹„ìŠ¤ì—ì„œ Heartbeatê°€ ëŠê¹€
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì¼ ê°€ëŠ¥ì„±
- ì¼ì‹œì ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì œê±° ì•ˆ í•¨

**í•´ê²°:**
1. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ í•´ê²°
2. ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¹„í™œì„±í™” ê°€ëŠ¥:

```yaml
eureka:
  server:
    enable-self-preservation: false  # ê°œë°œ í™˜ê²½ë§Œ!
```

### "No instances available" ì˜¤ë¥˜

```
com.netflix.client.ClientException: 
Load balancer does not have available server for client: user-service
```

**ì›ì¸:**
- í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ Eurekaì— ë“±ë¡ë˜ì§€ ì•ŠìŒ
- ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ DOWN ìƒíƒœ

**í•´ê²°:**
1. Eureka Dashboard í™•ì¸ (http://localhost:8761)
2. ì„œë¹„ìŠ¤ê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. Statusê°€ UPì¸ì§€ í™•ì¸
4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘

---

## Best Practices

### 1. ì„œë¹„ìŠ¤ëª…ì€ ì†Œë¬¸ì-í•˜ì´í”ˆ ì‚¬ìš©

**âœ… ì¢‹ì€ ì˜ˆ:**
```yaml
spring:
  application:
    name: user-service
```

**âŒ ë‚˜ìœ ì˜ˆ:**
```yaml
spring:
  application:
    name: UserService  # ëŒ€ì†Œë¬¸ì í˜¼ìš©
    name: user_service  # ì–¸ë”ìŠ¤ì½”ì–´
```

### 2. Heartbeat ê°„ê²© ì ì ˆíˆ ì„¤ì •

**ê°œë°œ í™˜ê²½:**
```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 10  # ë¹ ë¥¸ ê°ì§€
    lease-expiration-duration-in-seconds: 30
```

**í”„ë¡œë•ì…˜ í™˜ê²½:**
```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 30  # ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œ
    lease-expiration-duration-in-seconds: 90
```

### 3. Health Check ì—”ë“œí¬ì¸íŠ¸ ì œê³µ

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always
```

```java
// Spring Boot Actuatorê°€ ìë™ìœ¼ë¡œ ì œê³µ
// GET /actuator/health
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP"
    },
    "diskSpace": {
      "status": "UP"
    }
  }
}
```

### 4. í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬

**application.yml (ê¸°ë³¸):**
```yaml
spring:
  application:
    name: user-service
  profiles:
    active: local
```

**application-local.yml (ë¡œì»¬ ê°œë°œ):**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
```

**application-docker.yml (Docker í™˜ê²½):**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://eureka-server:8761/eureka/
```

**application-prod.yml (í”„ë¡œë•ì…˜):**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/,http://eureka2:8761/eureka/
```

### 5. Eureka Server HA (High Availability)

**í”„ë¡œë•ì…˜ì—ì„œëŠ” Eureka Serverë¥¼ ì—¬ëŸ¬ ê°œ ìš´ì˜:**

**Eureka Server 1:**
```yaml
server:
  port: 8761

eureka:
  client:
    service-url:
      defaultZone: http://eureka2:8762/eureka/  # ë‹¤ë¥¸ Eureka ì„œë²„
```

**Eureka Server 2:**
```yaml
server:
  port: 8762

eureka:
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/  # ì²« ë²ˆì§¸ Eureka ì„œë²„
```

**ì„œë¹„ìŠ¤ ì„¤ì •:**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/,http://eureka2:8762/eureka/
```

### 6. ë³´ì•ˆ ì„¤ì •

**Eureka Serverì— Spring Security ì ìš©:**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeHttpRequests(auth -> auth
                .anyRequest().authenticated()
            )
            .httpBasic();
        return http.build();
    }
}
```

```yaml
spring:
  security:
    user:
      name: admin
      password: secret123
```

**í´ë¼ì´ì–¸íŠ¸ ì„¤ì •:**
```yaml
eureka:
  client:
    service-url:
      defaultZone: http://admin:secret123@localhost:8761/eureka/
```

### 7. ë¡œê¹… ì„¤ì •

```yaml
logging:
  level:
    com.netflix.eureka: DEBUG
    com.netflix.discovery: DEBUG
```

### 8. Metadata í™œìš©

```yaml
eureka:
  instance:
    metadata-map:
      version: 1.0.0
      environment: production
      zone: us-east-1a
```

---

## ìš”ì•½

### Eurekaì˜ ì—­í• 

```
ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì „í™”ë²ˆí˜¸ë¶€ ğŸ“
- ì„œë¹„ìŠ¤ ë“±ë¡
- ì„œë¹„ìŠ¤ ë°œê²¬
- Health Check
- Load Balancing
- Failover
```

### í•µì‹¬ í¬ì¸íŠ¸

1. **`spring.application.name`** - ê°€ì¥ ì¤‘ìš”í•œ ì„¤ì •
2. **`@EnableEurekaServer`** - Eureka Server
3. **`@EnableDiscoveryClient`** - Eureka Client
4. **`lb://service-name`** - ë¡œë“œ ë°¸ëŸ°ì‹±
5. **Heartbeat** - 30ì´ˆë§ˆë‹¤ ìƒì¡´ ì‹ í˜¸

### ì‹¤í–‰ ìˆœì„œ

```
1. Eureka Server ì‹œì‘ (8761)
2. ì„œë¹„ìŠ¤ë“¤ ì‹œì‘ (User, Product, Order...)
3. ê° ì„œë¹„ìŠ¤ê°€ Eurekaì— ë“±ë¡
4. API Gatewayê°€ Eurekaë¥¼ í†µí•´ ì„œë¹„ìŠ¤ í˜¸ì¶œ
```

### Dashboard ì ‘ì†

```
http://localhost:8761
```

---

## ì°¸ê³  ìë£Œ

- [Spring Cloud Netflix Eureka ê³µì‹ ë¬¸ì„œ](https://cloud.spring.io/spring-cloud-netflix/reference/html/)
- [Netflix Eureka GitHub](https://github.com/Netflix/eureka)
- [Spring Cloud ê³µì‹ ê°€ì´ë“œ](https://spring.io/projects/spring-cloud)

---

**EurekaëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì¸í”„ë¼ì…ë‹ˆë‹¤!** ğŸš€

ì„œë¹„ìŠ¤ë“¤ì´ ì„œë¡œë¥¼ ì‰½ê²Œ ì°¾ê³  í†µì‹ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í•„ìˆ˜ ë„êµ¬ì…ë‹ˆë‹¤.