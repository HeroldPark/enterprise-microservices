# 사용자 관리 기능 가이드

## 📋 개요

ADMIN 권한을 가진 사용자가 모든 사용자를 관리할 수 있는 완전한 사용자 관리 시스템입니다.

## ✨ 주요 기능

### 1. 사용자 목록 조회
- ✅ 페이지네이션 (페이지당 10개)
- ✅ 실시간 검색 (이름, 이메일, 아이디)
- ✅ 권한별 필터링 (ADMIN, USER, GUEST)
- ✅ 상태별 필터링 (활성/비활성)
- ✅ 정렬 가능한 테이블

### 2. 사용자 정보 표시
- 👤 프로필 (이니셜 아바타)
- 📧 연락처 (이메일, 전화번호)
- 🔐 권한 배지
- ✅ 상태 표시
- 📅 가입일/수정일

### 3. 사용자 관리 작업
- ➕ 새 사용자 생성
- ✏️ 사용자 정보 수정
- 🗑️ 사용자 삭제
- 🔄 권한 변경
- 🔓 계정 활성화/비활성화

## 🎨 UI 구성요소

### Header
- 사용자 아이콘
- 전체 사용자 수
- "새 사용자 추가" 버튼

### Filters
```
┌─────────────────────────────────────────┐
│ 검색: [________________]                 │
│ 권한: [전체 ▼]  상태: [전체 ▼]          │
│ X개의 사용자가 검색되었습니다.           │
└─────────────────────────────────────────┘
```

### Table
```
┌──────────┬──────────┬──────┬──────┬──────────┬──────┐
│ 사용자   │ 연락처   │ 권한 │ 상태 │ 가입일   │ 작업 │
├──────────┼──────────┼──────┼──────┼──────────┼──────┤
│ [avatar] │ email    │ USER │ ✓활성│ 2024-... │ ✏️🗑️ │
│ name     │ phone    │      │      │          │      │
└──────────┴──────────┴──────┴──────┴──────────┴──────┘
```

### Modal (생성/수정)
- 아이디
- 이메일
- 이름/성
- 전화번호
- 권한 선택
- 계정 활성화 체크박스
- 권한 안내 메시지

## 🚀 설치 방법

### 1. 파일 복사

```bash
# Admin 컴포넌트
cp -r enterprise-app-complete/src/components/admin src/components/

# App.jsx 업데이트
cp enterprise-app-complete/src/App.jsx src/
```

### 2. 라우트 확인

App.jsx에 다음 라우트가 추가되어 있습니다:

```javascript
// Admin Panel
<Route path="/admin" element={
  <RoleBasedRoute requiredRole={ROLES.ADMIN}>
    <AdminPanel />
  </RoleBasedRoute>
} />

// User Management
<Route path="/admin/users" element={
  <RoleBasedRoute requiredRole={ROLES.ADMIN}>
    <UserManagement />
  </RoleBasedRoute>
} />
```

### 3. API 연동 (선택사항)

현재는 Mock 데이터를 사용하고 있습니다. 실제 API와 연동하려면:

```javascript
// UserManagement.jsx에서
import userManagementService from '../services/userManagementService'

// useEffect 수정
useEffect(() => {
  const fetchUsers = async () => {
    try {
      setIsLoading(true)
      const data = await userManagementService.getAllUsers()
      setUsers(data.content || data)
    } catch (error) {
      console.error('사용자 조회 실패:', error)
      alert('사용자 목록을 불러오는데 실패했습니다.')
    } finally {
      setIsLoading(false)
    }
  }
  
  fetchUsers()
}, [])
```

## 🔧 백엔드 API 필요사항

### 필수 엔드포인트

```
GET    /admin/users              # 사용자 목록 조회
GET    /admin/users/{id}         # 사용자 상세 조회
POST   /admin/users              # 사용자 생성
PUT    /admin/users/{id}         # 사용자 수정
DELETE /admin/users/{id}         # 사용자 삭제
GET    /admin/users/search       # 사용자 검색
PATCH  /admin/users/{id}/status  # 상태 변경
PATCH  /admin/users/{id}/role    # 권한 변경
```

### 요청/응답 예시

#### 사용자 목록 조회
```javascript
// GET /admin/users?page=0&size=10&sortBy=createdAt&direction=DESC

// Response
{
  content: [
    {
      id: 1,
      username: "admin",
      email: "admin@example.com",
      firstName: "Admin",
      lastName: "User",
      phoneNumber: "010-1234-5678",
      role: "ADMIN",
      enabled: true,
      createdAt: "2024-01-15T10:30:00",
      updatedAt: "2024-01-20T14:20:00"
    }
  ],
  totalPages: 5,
  totalElements: 50,
  size: 10,
  number: 0
}
```

#### 사용자 생성
```javascript
// POST /admin/users
{
  username: "newuser",
  email: "newuser@example.com",
  password: "password123",  // 암호화 필요
  firstName: "New",
  lastName: "User",
  phoneNumber: "010-0000-0000",
  role: "USER",
  enabled: true
}
```

#### 사용자 수정
```javascript
// PUT /admin/users/1
{
  email: "updated@example.com",
  firstName: "Updated",
  lastName: "Name",
  phoneNumber: "010-9999-9999",
  role: "ADMIN",
  enabled: false
}
```

## 🎯 사용 시나리오

### 시나리오 1: 새 사용자 추가

1. "새 사용자 추가" 버튼 클릭
2. 모달에서 정보 입력:
   - 아이디: john_new
   - 이메일: john@company.com
   - 이름: John
   - 성: Doe
   - 전화번호: 010-1111-2222
   - 권한: USER
   - 계정 활성화: ✓
3. "생성" 버튼 클릭
4. 성공 알림 및 목록 갱신

### 시나리오 2: 사용자 검색 및 편집

1. 검색창에 "john" 입력
2. 필터링된 사용자 목록 표시
3. 편집 버튼 클릭
4. 정보 수정 (예: 권한을 ADMIN으로 변경)
5. "저장" 버튼 클릭
6. 성공 알림 및 목록 갱신

### 시나리오 3: 비활성 사용자 관리

1. 상태 필터에서 "비활성" 선택
2. 비활성 사용자 목록 표시
3. 편집 버튼으로 계정 활성화 또는 삭제

### 시나리오 4: 권한별 사용자 관리

1. 권한 필터에서 "관리자" 선택
2. ADMIN 권한 사용자만 표시
3. 필요시 권한 변경 또는 관리

## 🎨 커스터마이징

### 1. 페이지당 항목 수 변경

```javascript
const [itemsPerPage] = useState(20) // 10 → 20으로 변경
```

### 2. 테이블 컬럼 추가

```jsx
// thead에 추가
<th className="px-6 py-3...">
  새 컬럼
</th>

// tbody에 추가
<td className="px-6 py-4...">
  {user.newField}
</td>
```

### 3. 권한 배지 색상 변경

```javascript
const getRoleBadgeStyle = (role) => {
  const styles = {
    ADMIN: 'bg-purple-100 text-purple-700 border-purple-300',
    USER: 'bg-green-100 text-green-700 border-green-300',
    GUEST: 'bg-yellow-100 text-yellow-700 border-yellow-300'
  }
  return styles[role] || styles.GUEST
}
```

### 4. 검색 필드 추가

```javascript
// 전화번호로도 검색
result = result.filter(user => 
  user.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
  user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
  user.firstName.toLowerCase().includes(searchTerm.toLowerCase()) ||
  user.lastName.toLowerCase().includes(searchTerm.toLowerCase()) ||
  user.phoneNumber.includes(searchTerm)  // 추가
)
```

## 🔒 보안 고려사항

### 1. 권한 검증
- 백엔드에서 ADMIN 권한 재확인 필수
- JWT 토큰 검증

### 2. 입력 검증
- 이메일 형식 검증
- 전화번호 형식 검증
- SQL Injection 방지
- XSS 방지

### 3. 비밀번호 처리
- 프론트엔드에서 비밀번호 표시하지 않음
- 백엔드에서 암호화 (BCrypt 등)
- 비밀번호 변경은 별도 API

### 4. 민감 정보 보호
- HTTPS 사용
- 토큰 만료 시간 설정
- 로그아웃 시 토큰 무효화

## 📊 통계 및 분석

### 추가 가능한 기능

```javascript
// 사용자 통계
const stats = {
  totalUsers: users.length,
  activeUsers: users.filter(u => u.enabled).length,
  adminCount: users.filter(u => u.role === 'ADMIN').length,
  userCount: users.filter(u => u.role === 'USER').length,
  guestCount: users.filter(u => u.role === 'GUEST').length
}
```

### 차트 통합

```javascript
// recharts 사용 예시
import { PieChart, Pie, Cell } from 'recharts'

const roleData = [
  { name: 'ADMIN', value: adminCount },
  { name: 'USER', value: userCount },
  { name: 'GUEST', value: guestCount }
]
```

## 🐛 트러블슈팅

### 문제: 사용자 목록이 로딩되지 않음
→ API 엔드포인트 확인
→ 네트워크 탭에서 응답 확인
→ CORS 설정 확인

### 문제: 권한 필터가 작동하지 않음
→ user.role 값 확인 (대소문자 일치)
→ filterRole 상태 확인

### 문제: 페이지네이션 오류
→ totalPages 계산 확인
→ currentPage 범위 확인

### 문제: 모달이 닫히지 않음
→ setIsModalOpen(false) 호출 확인
→ 이벤트 전파 확인 (stopPropagation)

## 🚀 향후 개선사항

1. **대량 작업**
   - 여러 사용자 선택
   - 일괄 권한 변경
   - 일괄 삭제

2. **고급 필터**
   - 날짜 범위 필터
   - 다중 조건 필터
   - 저장된 필터

3. **엑스포트**
   - CSV 다운로드
   - Excel 다운로드
   - PDF 리포트

4. **활동 로그**
   - 사용자 활동 기록
   - 로그인 기록
   - 변경 이력

5. **알림**
   - 이메일 알림
   - 실시간 알림
   - 권한 변경 알림

## 💡 팁

- 검색과 필터를 조합하여 정확한 사용자 찾기
- 정기적으로 비활성 사용자 정리
- 관리자 권한은 신중하게 부여
- 중요한 작업 전 백업 권장

Happy Managing! 👨‍💼
